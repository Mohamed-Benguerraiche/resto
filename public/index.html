<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte des restaurants solidaires</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    #map { width: 100%; height: 90vh; }
  </style>
</head>
<body>
  <h1 class="text-center my-3">Carte des lieux solidaires</h1>
  <div id="map"></div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: 'https://demotiles.maplibre.org/style.json',
      center: [2.2137, 46.2276],
      zoom: 5
    });

    async function chargerLieux() {
      const res = await fetch('/api/lieux');
      const lieux = await res.json();
      for (const lieu of lieux) {
        const popup = new maplibregl.Popup({ offset: 25 }).setText(
          `${lieu.nom} — ${lieu.adresse}, ${lieu.ville}`
        );
        new maplibregl.Marker()
          .setLngLat([2.2137, 46.2276]) // Valeur fixe ici ; option : géocoder les adresses
          .setPopup(popup)
          .addTo(map);
      }
    }

    chargerLieux();
  </script>
</body>
</html>
